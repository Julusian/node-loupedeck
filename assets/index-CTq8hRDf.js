(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();const M=11970,V=5426;var Y;(function(n){n[n.SHORT=1]="SHORT",n[n.MEDIUM=10]="MEDIUM",n[n.LONG=15]="LONG",n[n.LOW=49]="LOW",n[n.SHORT_LOW=50]="SHORT_LOW",n[n.SHORT_LOWER=51]="SHORT_LOWER",n[n.LOWER=64]="LOWER",n[n.LOWEST=65]="LOWEST",n[n.DESCEND_SLOW=70]="DESCEND_SLOW",n[n.DESCEND_MED=71]="DESCEND_MED",n[n.DESCEND_FAST=72]="DESCEND_FAST",n[n.ASCEND_SLOW=82]="ASCEND_SLOW",n[n.ASCEND_MED=83]="ASCEND_MED",n[n.ASCEND_FAST=88]="ASCEND_FAST",n[n.REV_SLOWEST=94]="REV_SLOWEST",n[n.REV_SLOW=95]="REV_SLOW",n[n.REV_MED=96]="REV_MED",n[n.REV_FAST=97]="REV_FAST",n[n.REV_FASTER=98]="REV_FASTER",n[n.REV_FASTEST=99]="REV_FASTEST",n[n.RISE_FALL=106]="RISE_FALL",n[n.BUZZ=112]="BUZZ",n[n.RUMBLE5=119]="RUMBLE5",n[n.RUMBLE4=120]="RUMBLE4",n[n.RUMBLE3=121]="RUMBLE3",n[n.RUMBLE2=122]="RUMBLE2",n[n.RUMBLE1=123]="RUMBLE1",n[n.VERY_LONG=118]="VERY_LONG"})(Y||(Y={}));var w;(function(n){n.Left="left",n.Center="center",n.Right="right",n.Wheel="wheel"})(w||(w={}));const he=new Uint8Array([0,77]),ue=new Uint8Array([0,87]),fe=new Uint8Array([0,76]),pe=new Uint8Array([0,65]),we=new Uint8Array([0,82]);var D;(function(n){n.RGB="rgb"})(D||(D={}));var E;(function(n){n.LoupedeckCtV1="loupedeck-ct-v1",n.LoupedeckCtV2="loupedeck-ct-v2",n.LoupedeckLive="loupedeck-live",n.LoupedeckLiveS="loupedeck-live-s",n.RazerStreamController="razer-stream-controller",n.RazerStreamControllerX="razer-stream-controller-x"})(E||(E={}));function ye(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var G={exports:{}},j;function ge(){return j||(j=1,(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(c,l,d){this.fn=c,this.context=l,this.once=d||!1}function s(c,l,d,h,p){if(typeof d!="function")throw new TypeError("The listener must be a function");var f=new i(d,h||c,p),y=t?t+l:l;return c._events[y]?c._events[y].fn?c._events[y]=[c._events[y],f]:c._events[y].push(f):(c._events[y]=f,c._eventsCount++),c}function o(c,l){--c._eventsCount===0?c._events=new r:delete c._events[l]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],d,h;if(this._eventsCount===0)return l;for(h in d=this._events)e.call(d,h)&&l.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(d)):l},a.prototype.listeners=function(l){var d=t?t+l:l,h=this._events[d];if(!h)return[];if(h.fn)return[h.fn];for(var p=0,f=h.length,y=new Array(f);p<f;p++)y[p]=h[p].fn;return y},a.prototype.listenerCount=function(l){var d=t?t+l:l,h=this._events[d];return h?h.fn?1:h.length:0},a.prototype.emit=function(l,d,h,p,f,y){var m=t?t+l:l;if(!this._events[m])return!1;var u=this._events[m],v=arguments.length,I,g;if(u.fn){switch(u.once&&this.removeListener(l,u.fn,void 0,!0),v){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,d),!0;case 3:return u.fn.call(u.context,d,h),!0;case 4:return u.fn.call(u.context,d,h,p),!0;case 5:return u.fn.call(u.context,d,h,p,f),!0;case 6:return u.fn.call(u.context,d,h,p,f,y),!0}for(g=1,I=new Array(v-1);g<v;g++)I[g-1]=arguments[g];u.fn.apply(u.context,I)}else{var de=u.length,O;for(g=0;g<de;g++)switch(u[g].once&&this.removeListener(l,u[g].fn,void 0,!0),v){case 1:u[g].fn.call(u[g].context);break;case 2:u[g].fn.call(u[g].context,d);break;case 3:u[g].fn.call(u[g].context,d,h);break;case 4:u[g].fn.call(u[g].context,d,h,p);break;default:if(!I)for(O=1,I=new Array(v-1);O<v;O++)I[O-1]=arguments[O];u[g].fn.apply(u[g].context,I)}}return!0},a.prototype.on=function(l,d,h){return s(this,l,d,h,!1)},a.prototype.once=function(l,d,h){return s(this,l,d,h,!0)},a.prototype.removeListener=function(l,d,h,p){var f=t?t+l:l;if(!this._events[f])return this;if(!d)return o(this,f),this;var y=this._events[f];if(y.fn)y.fn===d&&(!p||y.once)&&(!h||y.context===h)&&o(this,f);else{for(var m=0,u=[],v=y.length;m<v;m++)(y[m].fn!==d||p&&!y[m].once||h&&y[m].context!==h)&&u.push(y[m]);u.length?this._events[f]=u.length===1?u[0]:u:o(this,f)}return this},a.prototype.removeAllListeners=function(l){var d;return l?(d=t?t+l:l,this._events[d]&&o(this,d)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(G)),G.exports}var me=ge();const k=ye(me);function Q(n,e,t,r){const i=t+r.rowGap,s=t+r.columnGap;return[(c,l)=>!(r.rowGap>0&&(e+l)%i>=t||r.columnGap>0&&(n+c)%s>=t),c=>!(r.rowGap>0&&(e+c)%i>=t)]}function Se(n,e,t,r,i,s,o,a,c){const l=i*s;if(n.length!==l*t.length)throw new Error(`Incorrect buffer length ${n.length} expected ${l*t.length}`);if(e.length!==l*2+r)throw new Error(`Incorrect buffer length ${e.length} expected ${l*2+r}`);const d=S(n),h=S(e);switch(t){case D.RGB:for(let p=0;p<s;p++)if(a(p))for(let f=0;f<i;f++){if(!o(f,p))continue;const y=p*i+f,m=d.getUint8(y*3+0)>>3,u=d.getUint8(y*3+1)>>2,v=d.getUint8(y*3+2)>>3;h.setUint16(r+y*2,(m<<11)+(u<<5)+v,c!=="BE")}break;default:throw new Error(`Unknown BufferFormat: "${t}"`)}}function C(n){if(n<0||n>255)throw new TypeError("Expected a valid color RGB value 0 - 255")}function Ee(n){C(n.red),C(n.green),C(n.blue)}function S(n){return new DataView(n.buffer,n.byteOffset,n.byteLength)}function xe(n){if(n.length>255){const e=new Uint8Array(14),t=S(e);return t.setUint8(0,130),t.setUint8(1,255),t.setUint32(6,n.length,!1),e}else{const e=new Uint8Array(6),t=S(e);return t.setUint8(0,130),t.setUint8(1,128+n.length),e}}class oe extends Error{constructor(e){super(e),this.name="TimeoutError"}}class be extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}const Z=n=>globalThis.DOMException===void 0?new be(n):new DOMException(n),J=n=>{const e=n.reason===void 0?Z("This operation was aborted."):n.reason;return e instanceof Error?e:Z(e)};function ve(n,e){const{milliseconds:t,fallback:r,message:i,customTimers:s={setTimeout,clearTimeout}}=e;let o,a;const l=new Promise((d,h)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){const{signal:f}=e;f.aborted&&h(J(f)),a=()=>{h(J(f))},f.addEventListener("abort",a,{once:!0})}if(t===Number.POSITIVE_INFINITY){n.then(d,h);return}const p=new oe;o=s.setTimeout.call(void 0,()=>{if(r){try{d(r())}catch(f){h(f)}return}typeof n.cancel=="function"&&n.cancel(),i===!1?d():i instanceof Error?h(i):(p.message=i??`Promise timed out after ${t} milliseconds`,h(p))},t),(async()=>{try{d(await n)}catch(f){h(f)}})()}).finally(()=>{l.clear(),a&&e.signal&&e.signal.removeEventListener("abort",a)});return l.clear=()=>{s.clearTimeout.call(void 0,o),o=void 0},l}function Re(n,e,t){let r=0,i=n.length;for(;i>0;){const s=Math.trunc(i/2);let o=r+s;t(n[o],e)<=0?(r=++o,i-=s+1):i=s}return r}class Te{#e=[];enqueue(e,t){t={priority:0,...t};const r={priority:t.priority,id:t.id,run:e};if(this.size===0||this.#e[this.size-1].priority>=t.priority){this.#e.push(r);return}const i=Re(this.#e,r,(s,o)=>o.priority-s.priority);this.#e.splice(i,0,r)}setPriority(e,t){const r=this.#e.findIndex(s=>s.id===e);if(r===-1)throw new ReferenceError(`No promise function with the id "${e}" exists in the queue.`);const[i]=this.#e.splice(r,1);this.enqueue(i.run,{priority:t,id:e})}dequeue(){return this.#e.shift()?.run}filter(e){return this.#e.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this.#e.length}}class Ie extends k{#e;#i;#o=0;#a;#l;#d=0;#r;#h;#n;#f;#s=0;#c;#t;#u;#p=1n;timeout;constructor(e){if(super(),e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:Te,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${e.intervalCap?.toString()??""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${e.interval?.toString()??""}\` (${typeof e.interval})`);this.#e=e.carryoverConcurrencyCount,this.#i=e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,this.#a=e.intervalCap,this.#l=e.interval,this.#n=new e.queueClass,this.#f=e.queueClass,this.concurrency=e.concurrency,this.timeout=e.timeout,this.#u=e.throwOnTimeout===!0,this.#t=e.autoStart===!1}get#w(){return this.#i||this.#o<this.#a}get#x(){return this.#s<this.#c}#b(){this.#s--,this.#y(),this.emit("next")}#v(){this.#E(),this.#S(),this.#h=void 0}get#R(){const e=Date.now();if(this.#r===void 0){const t=this.#d-e;if(t<0)this.#o=this.#e?this.#s:0;else return this.#h===void 0&&(this.#h=setTimeout(()=>{this.#v()},t)),!0}return!1}#y(){if(this.#n.size===0)return this.#r&&clearInterval(this.#r),this.#r=void 0,this.emit("empty"),this.#s===0&&this.emit("idle"),!1;if(!this.#t){const e=!this.#R;if(this.#w&&this.#x){const t=this.#n.dequeue();return t?(this.emit("active"),t(),e&&this.#S(),!0):!1}}return!1}#S(){this.#i||this.#r!==void 0||(this.#r=setInterval(()=>{this.#E()},this.#l),this.#d=Date.now()+this.#l)}#E(){this.#o===0&&this.#s===0&&this.#r&&(clearInterval(this.#r),this.#r=void 0),this.#o=this.#e?this.#s:0,this.#g()}#g(){for(;this.#y(););}get concurrency(){return this.#c}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this.#c=e,this.#g()}async#T(e){return new Promise((t,r)=>{e.addEventListener("abort",()=>{r(e.reason)},{once:!0})})}setPriority(e,t){this.#n.setPriority(e,t)}async add(e,t={}){return t.id??=(this.#p++).toString(),t={timeout:this.timeout,throwOnTimeout:this.#u,...t},new Promise((r,i)=>{this.#n.enqueue(async()=>{this.#s++;try{t.signal?.throwIfAborted(),this.#o++;let s=e({signal:t.signal});t.timeout&&(s=ve(Promise.resolve(s),{milliseconds:t.timeout})),t.signal&&(s=Promise.race([s,this.#T(t.signal)]));const o=await s;r(o),this.emit("completed",o)}catch(s){if(s instanceof oe&&!t.throwOnTimeout){r();return}i(s),this.emit("error",s)}finally{this.#b()}},t),this.emit("add"),this.#y()})}async addAll(e,t){return Promise.all(e.map(async r=>this.add(r,t)))}start(){return this.#t?(this.#t=!1,this.#g(),this):this}pause(){this.#t=!0}clear(){this.#n=new this.#f}async onEmpty(){this.#n.size!==0&&await this.#m("empty")}async onSizeLessThan(e){this.#n.size<e||await this.#m("next",()=>this.#n.size<e)}async onIdle(){this.#s===0&&this.#n.size===0||await this.#m("idle")}async#m(e,t){return new Promise(r=>{const i=()=>{t&&!t()||(this.off(e,i),r())};this.on(e,i)})}get size(){return this.#n.size}sizeBy(e){return this.#n.filter(e).length}get pending(){return this.#s}get isPaused(){return this.#t}}var x;(function(n){n[n.SetColour=2]="SetColour",n[n.GetSerialNumber=3]="GetSerialNumber",n[n.GetVersion=7]="GetVersion",n[n.SetBrightness=9]="SetBrightness",n[n.RefreshDisplay=15]="RefreshDisplay",n[n.DrawFramebuffer=16]="DrawFramebuffer",n[n.SetVibration=27]="SetVibration"})(x||(x={}));class _ extends k{#e={};#i;options;modelSpec;get controls(){return this.modelSpec.controls}get displayMain(){return this.modelSpec.displayMain}get displayLeftStrip(){return this.modelSpec.displayLeftStrip}get displayRightStrip(){return this.modelSpec.displayRightStrip}get displayWheel(){return this.modelSpec.displayWheel}#o={};#a=0;#l;constructor(e,t,r){super(),this.#i=e,this.options={...t},this.modelSpec=r,this.options.skipWaitForAcks||(this.#l=new Ie({concurrency:1})),this.#i.on("error",i=>{this.#r(),this.emit("error",i)}),this.#i.on("disconnect",()=>{this.#r(),this.emit("error",new Error("Connection lost"))}),this.#i.on("message",this.#h.bind(this))}get modelId(){return this.modelSpec.modelId}get modelName(){return this.modelSpec.modelName}get lcdKeySize(){return this.modelSpec.lcdKeySize}#d(e){switch(e){case w.Center:return this.displayMain;case w.Left:return this.displayLeftStrip;case w.Right:return this.displayRightStrip;case w.Wheel:return this.displayWheel;default:return}}async blankDevice(e=!0,t=!0){await this.#c(async()=>{if(e)for(const r of Object.values(w)){const i=this.#d(r);if(i){const{encoded:s,encodedDisplay:o}=this.createBufferWithHeader(r,i.width+i.xPadding*2,i.height+i.yPadding*2,0,0);await this.#t(x.DrawFramebuffer,s,!0),this.modelSpec.framebufferFlush&&await this.#t(x.RefreshDisplay,o,!0)}}if(t){const r=this.controls.filter(o=>o.type==="button"&&o.feedbackType==="rgb"),i=new Uint8Array(4*r.length),s=S(i);for(let o=0;o<r.length;o++)s.setUint8(o*4,r[o].encodedIndex);await this.#t(x.SetColour,i,!0)}},!1)}#r(){setTimeout(()=>{for(const e of Object.values(this.#o))e.reject(new Error("Connection closed"))},0)}async close(){this.#r(),await this.#i.close()}createBufferWithHeader(e,t,r,i,s){if(!this.modelSpec.splitTopDisplays&&!(e===w.Left||e===w.Wheel))if(e===w.Center)i+=this.displayLeftStrip?.width??0;else if(e===w.Right)i+=(this.displayLeftStrip?.width??0)+(this.displayMain.width+this.displayMain.xPadding*2);else throw new Error("Unknown DisplayId");const o=10,a=t*r,c=new Uint8Array(a*2+o),l=S(c);let d=he;if(e===w.Wheel)d=ue;else if(this.modelSpec.splitTopDisplays)switch(e){case w.Center:d=pe;break;case w.Left:d=fe;break;case w.Right:d=we;break;default:throw new Error("Unknown DisplayId")}return c.set(d,0),l.setUint16(2,i,!1),l.setUint16(4,s,!1),l.setUint16(6,t,!1),l.setUint16(8,r,!1),{encoded:c,padding:o,encodedDisplay:d}}async drawBuffer(e,t,r,i,s,o,a){const c=this.#d(e);if(!c)throw new Error("Invalid DisplayId");if(i<0||i>c.width)throw new Error("Image width is not valid");if(s<0||s>c.height)throw new Error("Image width is not valid");if(o<0||o+i>c.width)throw new Error("x is not valid");if(a<0||a+s>c.height)throw new Error("x is not valid");const{encoded:l,padding:d,encodedDisplay:h}=this.createBufferWithHeader(e,i,s,o+c.xPadding,a+c.yPadding),[p,f]=Q(o,a,this.lcdKeySize,c);Se(t,l,r,d,i,s,p,f,c.endianness),await this.#c(async()=>{await this.#t(x.DrawFramebuffer,l,!0),this.modelSpec.framebufferFlush&&await this.#t(x.RefreshDisplay,h,!0)},!1)}async drawKeyBuffer(e,t,r){const i=this.controls.find(o=>o.type==="button"&&o.id===e);if(!i)throw new Error("Invalid button id");if(i.feedbackType!=="lcd")throw new Error("Control is not an LCD button");const s=this.lcdKeySize;return this.drawBuffer(w.Center,t,r,s,s,i.column,i.row)}async drawSolidColour(e,t,r,i,s,o){const a=this.#d(e);if(!a)throw new Error("Invalid DisplayId");if(r<0||r>a.width)throw new Error("Image width is not valid");if(i<0||i>a.height)throw new Error("Image height is not valid");if(s<0||s+r>a.width)throw new Error("x is not valid");if(o<0||o+i>a.height)throw new Error("y is not valid");Ee(t);const c=((Math.round(t.red)>>3&31)<<11)+((Math.round(t.green)>>2&63)<<5)+(Math.round(t.blue)>>3&31),[l,d]=Q(s,o,this.lcdKeySize,a),{encoded:h,padding:p,encodedDisplay:f}=this.createBufferWithHeader(e,r,i,s+a.xPadding,o),y=S(h);for(let m=0;m<i;m++)if(d(m)){for(let u=0;u<r;u++)if(l(u,m)){const v=m*r+u;y.setUint16(v*2+p,c,a.endianness!=="BE")}}await this.#c(async()=>{await this.#t(x.DrawFramebuffer,h,!0),this.modelSpec.framebufferFlush&&await this.#t(x.RefreshDisplay,f,!0)},!1)}async getFirmwareVersion(){const e=await this.#u(x.GetVersion,void 0),t=S(e);return`${t.getUint8(0)}.${t.getUint8(1)}.${t.getUint8(2)}`}async getSerialNumber(){const e=await this.#u(x.GetSerialNumber,void 0);return new TextDecoder().decode(e).trim()}#h(e){try{const t=S(e);if(t.getUint8(2)+2!==e.length)return;const i=t.getUint8(3),s=t.getUint8(4);if(s===0)switch(i){case 0:this.#n(e.subarray(5));break;case 1:this.#f(e.subarray(5));break;case 77:this.onTouch("touchmove",e.subarray(5));break;case 109:this.onTouch("touchend",e.subarray(5));break;case 82:this.onWheelTouch("touchmove",e.subarray(5));break;case 114:this.onWheelTouch("touchend",e.subarray(5));break;default:console.warn("unhandled incoming message",e);break}else{const o=this.#o[s];o&&(o.resolve(e.subarray(5)),delete this.#o[s])}}catch(t){console.error("Unhandled error in serial message handler:",t)}}#n(e){const t=S(e),r=t.getUint8(0),i=this.controls.find(s=>(s.type==="button"||s.type==="encoder")&&s.encodedIndex===r);if(i){const s=t.getUint8(1)===0?"down":"up";this.emit(s,i)}}#f(e){const t=S(e),r=t.getUint8(0),i=r===0?this.controls.find(s=>s.type==="wheel"):this.controls.find(s=>s.type==="encoder"&&s.encodedIndex===r);if(i){const s=t.getInt8(1);this.emit("rotate",i,s)}}#s(e,t,r,i,s,o){const a={x:t,y:r,id:i,target:{screen:s,key:o}};e==="touchend"?delete this.#e[a.id]:(this.#e[a.id]||(e="touchstart"),this.#e[a.id]=a),this.emit(e,{touches:Object.values(this.#e),changedTouches:[a]})}onTouch(e,t){const r=S(t);let i=r.getUint16(1,!1),s=r.getUint16(3,!1);const o=r.getUint8(5),a=this.displayMain.width+this.displayMain.xPadding*2,c=this.displayLeftStrip?.width??0;let l=w.Center;const d=(this.displayLeftStrip?.width??0)+a;this.displayLeftStrip&&i<c?l=w.Left:this.displayRightStrip&&i>=d?(l=w.Right,i-=d):(i-=c+this.displayMain.xPadding,s-=this.displayMain.yPadding);let h;if(l===w.Center){const p=i+this.displayMain.columnGap/2,f=s+this.displayMain.rowGap/2;h={row:Math.floor(f/(this.lcdKeySize+this.displayMain.rowGap)),column:Math.floor(p/(this.lcdKeySize+this.displayMain.columnGap))}}this.#s(e,i,s,o,l,h)}onWheelTouch(e,t){const r=S(t),i=r.getUint16(1,!1),s=r.getUint16(3,!1),o=r.getUint8(5),a=w.Wheel;this.#s(e,i,s,o,a,void 0)}async setBrightness(e){const r=Math.max(0,Math.min(10,Math.round(e*10)));return this.#t(x.SetBrightness,new Uint8Array([r]))}async setButtonColor(...e){if(e.length===0)return;const t={};for(const s of this.controls)s.type==="button"&&s.feedbackType==="rgb"&&(t[s.id]=s.encodedIndex);const r=new Uint8Array(4*e.length),i=S(r);for(let s=0;s<e.length;s++){const o=e[s],a=s*4,c=t[o.id];if(c===void 0)throw new TypeError("Expected a valid button id");C(o.red),C(o.green),C(o.blue),i.setUint8(0+a,c),i.setUint8(1+a,o.red),i.setUint8(2+a,o.green),i.setUint8(3+a,o.blue)}return this.#t(x.SetColour,r)}async vibrate(e){if(!e)throw new Error("Invalid vibrate pattern");return this.#t(x.SetVibration,new Uint8Array([e]))}async#c(e,t){return this.#l&&!t?this.#l.add(e,{throwOnTimeout:!0}):e()}async#t(e,t,r=!1){return this.#c(async()=>{const i=await this.#p(e,t);this.options.skipWaitForAcks||await this.#w(i)},r)}async#u(e,t,r=!1){return this.#c(async()=>{const i=await this.#p(e,t);return this.#w(i)},r)}async#p(e,t){if(!this.#i.isReady())throw new Error("Not connected!");this.#a=(this.#a+1)%256,this.#a===0&&this.#a++;const r=new Uint8Array(3+(t?.length??0)),i=S(r);return i.setUint8(0,r.length>=255?255:r.length),i.setUint8(1,e),i.setUint8(2,this.#a),t&&t.length&&r.set(t,3),await this.#i.send(r),this.#a}async#w(e){if(this.#o[e])throw new Error("Transaction handler already defined");if(!this.#i.isReady())throw new Error("Connection is not open");const t={resolve:()=>null,reject:()=>null},r=new Promise((i,s)=>{t.resolve=i,t.reject=s});return this.#o[e]=t,r}}function L(n){return Object.freeze(n.map(e=>Object.freeze(e)))}function P(n){const e=[];for(let t=0;t<8;t++)e.push({id:`button-${t+1}`,type:"button",row:3,column:t,encodedIndex:n+t,feedbackType:"rgb",isTouch:!1});return e}function ee(n,e){const t=[];for(let r=0;r<3;r++)t.push({id:`encoder-${r}-${e}`,type:"encoder",row:r,column:e,encodedIndex:n+r});return t}function F(n){return[...ee(n,0),...ee(n+3,7)]}function B(n){const e=[];for(let t=0;t<n.rows;t++)for(let r=0;r<n.columns;r++){const i=t*n.columns+r,s=t,o=r+n.colOffset;e.push({id:`button-${s}-${o}`,type:"button",row:s,column:o,encodedIndex:n.startEncodedIndex!==null?n.startEncodedIndex+i:0,feedbackType:"lcd",isTouch:n.startEncodedIndex===null})}return e}const De={width:60,height:270,xPadding:0,yPadding:0,columnGap:0,rowGap:0},Ce={width:350,height:260,xPadding:5,yPadding:5,columnGap:10,rowGap:10},_e={width:60,height:270,xPadding:0,yPadding:0,columnGap:0,rowGap:0},z={controls:[],displayMain:Ce,displayLeftStrip:De,displayRightStrip:_e,modelId:E.LoupedeckLive,modelName:"Loupedeck Live",lcdKeySize:80};z.controls.push(...P(7),...F(1),...B({rows:3,columns:4,colOffset:2,startEncodedIndex:null}));L(z.controls);class Le extends _{constructor(e,t){super(e,t,z)}}const Oe={width:60,height:270,xPadding:0,yPadding:0,columnGap:0,rowGap:0},Ue={width:350,height:260,xPadding:5,yPadding:5,columnGap:10,rowGap:10},Me={width:60,height:270,xPadding:0,yPadding:0,columnGap:0,rowGap:0},q={controls:[],displayMain:Ue,displayLeftStrip:Oe,displayRightStrip:Me,modelId:E.RazerStreamController,modelName:"Razer Stream Controller",lcdKeySize:80};q.controls.push(...P(7),...F(1),...B({rows:3,columns:4,colOffset:2,startEncodedIndex:null}));L(q.controls);class Be extends _{constructor(e,t){super(e,t,q)}}const Ae={width:444,height:260,xPadding:18,yPadding:5,columnGap:10,rowGap:10},A={controls:[],displayMain:Ae,displayLeftStrip:void 0,displayRightStrip:void 0,modelId:E.LoupedeckLiveS,modelName:"Loupedeck Live S",lcdKeySize:80};A.controls.push({type:"encoder",id:"encoder-0-0",row:0,column:0,encodedIndex:1},{type:"encoder",id:"encoder-1-0",row:1,column:0,encodedIndex:2},{type:"button",id:"button-2-0",row:2,column:0,encodedIndex:7,feedbackType:"rgb",isTouch:!1});for(let n=0;n<3;n++)A.controls.push({type:"button",id:`button-${n}-6`,row:n,column:6,encodedIndex:8+n,feedbackType:"rgb",isTouch:!1});L(A.controls);class $e extends _{constructor(e,t){super(e,t,A)}}const Ge={width:60,height:270,xPadding:0,yPadding:0,columnGap:0,rowGap:0},Ne={width:350,height:260,xPadding:5,yPadding:5,columnGap:10,rowGap:10},We={width:60,height:270,xPadding:0,yPadding:0,columnGap:0,rowGap:0},ke={width:240,height:240,xPadding:0,yPadding:0,columnGap:0,rowGap:0,endianness:"BE"},$={controls:[],displayMain:Ne,displayLeftStrip:Ge,displayRightStrip:We,displayWheel:ke,modelId:E.LoupedeckCtV2,modelName:"Loupedeck CT",lcdKeySize:80};$.controls.push(...P(7),...F(1),...B({rows:3,columns:4,colOffset:2,startEncodedIndex:null}),{type:"button",id:"button-home",row:4,column:0,encodedIndex:8,feedbackType:"rgb",isTouch:!1},{type:"button",id:"button-undo",row:5,column:0,encodedIndex:9,feedbackType:"rgb",isTouch:!1},{type:"button",id:"button-keyboard",row:6,column:0,encodedIndex:10,feedbackType:"rgb",isTouch:!1},{type:"button",id:"button-return",row:4,column:1,encodedIndex:11,feedbackType:"rgb",isTouch:!1},{type:"button",id:"button-save",row:5,column:1,encodedIndex:12,feedbackType:"rgb",isTouch:!1},{type:"button",id:"button-fn-left",row:6,column:1,encodedIndex:13,feedbackType:"rgb",isTouch:!1},{type:"button",id:"button-up",row:4,column:6,encodedIndex:14,feedbackType:"rgb",isTouch:!1},{type:"button",id:"button-left",row:5,column:6,encodedIndex:15,feedbackType:"rgb",isTouch:!1},{type:"button",id:"button-fn-right",row:6,column:6,encodedIndex:16,feedbackType:"rgb",isTouch:!1},{type:"button",id:"button-down",row:4,column:7,encodedIndex:17,feedbackType:"rgb",isTouch:!1},{type:"button",id:"button-right",row:5,column:7,encodedIndex:18,feedbackType:"rgb",isTouch:!1},{type:"button",id:"button-blank",row:6,column:7,encodedIndex:19,feedbackType:"rgb",isTouch:!1},{type:"wheel",id:"wheel",row:4,column:2,rowSpan:3,columnSpan:4});L($.controls);class Pe extends _{constructor(e,t){super(e,t,$)}}const Fe={width:470,height:270,xPadding:5,yPadding:0,columnGap:20,rowGap:18},H={controls:[],displayMain:Fe,displayLeftStrip:void 0,displayRightStrip:void 0,modelId:E.RazerStreamControllerX,modelName:"Razer Stream Controller X",lcdKeySize:78};H.controls.push(...B({rows:3,columns:5,colOffset:0,startEncodedIndex:27}));L(H.controls);class ze extends _{constructor(e,t){super(e,t,H)}onTouch(e,t){}}const ae={...$,splitTopDisplays:!0,modelId:E.LoupedeckCtV1,framebufferFlush:!0};L(ae.controls);class qe extends _{constructor(e,t){super(e,t,ae)}}const K=[{id:E.LoupedeckCtV1,vendorId:M,productId:3,class:qe},{id:E.LoupedeckCtV2,vendorId:M,productId:7,class:Pe},{id:E.LoupedeckLive,vendorId:M,productId:4,class:Le},{id:E.LoupedeckLiveS,vendorId:M,productId:6,class:$e},{id:E.RazerStreamController,vendorId:V,productId:3334,class:Be},{id:E.RazerStreamControllerX,vendorId:V,productId:3337,class:ze}],He=new TextEncoder().encode(`GET /index.html
HTTP/1.1
Connection: Upgrade
Upgrade: websocket
Sec-WebSocket-Key: 123abc

`),Ke="HTTP/1.1";class Xe extends k{}class X extends Xe{connection;reader;writer;isOpen;constructor(e,t,r){super(),this.connection=e,this.reader=t,this.writer=r,this.isOpen=!0,this.connection.addEventListener("error",i=>{this.emit("error",i)}),this.connection.addEventListener("connect",()=>{console.log("connect"),this.isOpen=!0;try{this.openReaderWriter()}catch(i){this.emit("error",i)}}),this.connection.addEventListener("disconnect",()=>{console.log("disconnect"),this.isOpen=!1,this.closeReaderWriter(),this.emit("disconnect")}),this.startReadLoop(this.reader)}startReadLoop(e){Promise.resolve().then(async()=>{const t=new Ve({delimiter:130});for(;;){const{value:r,done:i}=await e.read();if(r){const s=t.transform(r);for(const o of s)this.emit("message",o)}if(i){e.releaseLock();break}}}).catch(t=>{this.emit("error",t)})}closeReaderWriter(){this.writer&&(this.writer.close().catch(()=>null),delete this.writer)}openReaderWriter(){if(this.closeReaderWriter(),!this.connection)throw new Error("SerialPort is closed");if(!this.connection.writable)throw new Error("SerialPort is not writable");if(!this.connection.readable)throw new Error("SerialPort is not readable");this.writer=this.connection.writable.getWriter(),this.reader=this.connection.readable.getReader(),this.startReadLoop(this.reader)}static async open(e){let t,r;try{if(await e.open({baudRate:256e3}),!e.writable)throw new Error("SerialPort is not writable");if(!e.readable)throw new Error("SerialPort is not readable");r=e.writable.getWriter(),t=e.readable.getReader();let i=!1;const s=r,[o]=await Promise.all([t.read().then(c=>(i=!0,c)),new Promise((c,l)=>{setTimeout(()=>{l(new Error("Timed out"))},5e3);const d=()=>{i?c():s.write(He).then(()=>{setTimeout(d,10)}).catch(h=>{l(h instanceof Error?h:new Error(String(h)))})};d()})]).catch(c=>{throw i=!0,t?.cancel("Aborted").catch(()=>null),c});if(!o.value)throw new Error("No handshake response");const a=new TextDecoder().decode(o.value);if(!a.startsWith(Ke))throw new Error(`Invalid handshake response: ${a}`);return new X(e,t,r)}catch(i){throw e.close().catch(()=>null),t?.cancel("Aborted")?.catch(()=>null),r?.abort("Aborted")?.catch(()=>null),i}}async close(){this.writer&&(this.writer.close().catch(()=>null),delete this.writer),this.connection&&(await this.connection.close().catch(()=>null),delete this.connection)}isReady(){return this.connection!==void 0&&this.isOpen}async send(e,t=!1){if(!this.connection||!this.writer)throw new Error("Not connected!");if(!t){const r=xe(e);await this.writer.write(r)}await this.writer.write(e)}}class Ve{buffer=new Uint8Array(0);start=!0;opts;constructor(e={}){const{delimiter:t=170,packetOverhead:r=2,lengthOffset:i=1,maxLen:s=255}=e;this.opts={delimiter:t,packetOverhead:r,lengthOffset:i,maxLen:s}}transform(e){const t=[];for(let r=0;r<e.length;r++){const i=e[r];if(i===this.opts.delimiter&&(this.start=!0),this.start===!0){const s=this.buffer;this.buffer=new Uint8Array(s.length+1);const o=S(this.buffer);if(this.buffer.set(s,0),this.buffer[this.buffer.length-1]=i,this.buffer.length>=this.opts.lengthOffset+1){const a=o.getUint8(this.opts.lengthOffset);(this.buffer.length==a+this.opts.packetOverhead||a>this.opts.maxLen)&&(t.push(this.buffer),this.buffer=new Uint8Array(0),this.start=!1)}}}return t}}const Ye=K.map(n=>({usbProductId:n.productId,usbVendorId:n.vendorId}));async function je(n){const e=await navigator.serial.requestPort({filters:Ye});return ce(e)}async function Qe(n){const e=await navigator.serial.getPorts();if(e.length===0)return[];const t=new Set;for(const s of K)t.add(`${s.vendorId}-${s.productId}`);const r=e.filter(s=>{const o=s.getInfo();return t.has(`${o.usbVendorId}-${o.usbProductId}`)});return(await Promise.all(r.map(async s=>ce(s).catch(o=>null)))).filter(s=>!!s)}async function ce(n,e){const t=n.getInfo(),r=K.find(a=>a.productId===t.usbProductId&&a.vendorId===t.usbVendorId);if(!r)throw new Error("Stream Deck is of unexpected type.");const i=await X.open(n),s={};return new r.class(i,s||{})}function te(n){return`${n.type}-${n.index}`}const Ze={red:255,green:0,blue:0},Je={red:0,green:0,blue:0},ne=new Uint8Array(6400*3),W=new Uint8Array(6400*3);for(let n=0;n<6400;n++)W.set([255,0,0],n*3);class le{pressed=[];touchBoxes=new Set;touchingLeft=!1;touchingRight=!1;async start(e){await e.blankDevice(!0,!1)}async stop(e){await e.blankDevice(!0,!1)}async controlDown(e,t){const r=te(t);this.pressed.indexOf(r)===-1&&(this.pressed.push(r),e.modelId===E.RazerStreamControllerX?await e.drawKeyBuffer(t.index,W,D.RGB):await e.setButtonColor({id:t.index,...Ze}))}async controlUp(e,t){const r=te(t),i=this.pressed.indexOf(r);i!==-1&&(this.pressed.splice(i,1),e.modelId===E.RazerStreamControllerX?await e.drawKeyBuffer(t.index,ne,D.RGB):await e.setButtonColor({id:t.index,...Je}))}async controlRotate(e,t,r){}async touchStart(e,t){return this.touchMove(e,t)}async touchMove(e,t){const r=[],i=new Set;let s=0,o=0;for(const a of t.touches)if(a.target.screen===w.Center&&a.target.key!==void 0)i.add(a.target.key),this.touchBoxes.has(a.target.key)||(this.touchBoxes.add(a.target.key),r.push(e.drawKeyBuffer(a.target.key,W,D.RGB)));else if(a.target.screen===w.Left&&e.displayLeftStrip){const c=a.y/e.displayLeftStrip.height;s=Math.max(s,c)}else if(a.target.screen===w.Right&&e.displayRightStrip){const c=a.y/e.displayRightStrip.height;o=Math.max(o,c)}for(const a of this.touchBoxes)i.has(a)||(this.touchBoxes.delete(a),r.push(e.drawKeyBuffer(a,ne,D.RGB)));e.displayLeftStrip&&(s>0||this.touchingLeft)&&(this.touchingLeft=s>0,r.push(e.drawSolidColour(w.Left,{red:Math.round(255*s),green:0,blue:0},e.displayLeftStrip.width,e.displayLeftStrip.height,0,0))),e.displayRightStrip&&(o>0||this.touchingRight)&&(this.touchingRight=o>0,r.push(e.drawSolidColour(w.Right,{red:Math.round(255*o),green:0,blue:0},e.displayRightStrip.width,e.displayRightStrip.height,0,0))),await Promise.allSettled(r)}async touchEnd(e,t){return this.touchMove(e,t)}}function N(n,e){return n=Math.ceil(n),e=Math.floor(e),Math.floor(Math.random()*(e-n+1))+n}class et{interval;running;async start(e){if(!this.interval){const t=async()=>{if(!this.running){const r={red:N(0,255),green:N(0,255),blue:N(0,255)};console.log("Filling with rgb(%d, %d, %d)",r.red,r.green,r.blue),this.running=Promise.all([e.drawSolidColour(w.Center,r,e.displayMain.width,e.displayMain.height,0,0),e.displayLeftStrip?e.drawSolidColour(w.Left,r,e.displayLeftStrip.width,e.displayLeftStrip.height,0,0):void 0,e.displayRightStrip?e.drawSolidColour(w.Right,r,e.displayRightStrip.width,e.displayRightStrip.height,0,0):void 0]);try{await this.running}finally{this.running=void 0}}};this.interval=window.setInterval(()=>{t().catch(r=>console.log(r))},1e3/5)}}async stop(e){this.interval&&(window.clearInterval(this.interval),this.interval=void 0),await this.running,await e.blankDevice(!0,!0)}async controlDown(e,t){}async controlUp(e,t){}async controlRotate(e,t,r){}async touchStart(e,t){}async touchMove(e,t){}async touchEnd(e,t){}}function R(n){const e=document.getElementById("log");e&&(e.textContent=`${n}
${e.textContent??""}`)}const U=document.getElementById("demo-select"),re=document.getElementById("consent-button");let b=null,T=new le;async function ie(){if(U){switch(console.log(`Selected demo: ${U.value}`),b&&await T.stop(b),U.value){case"rapid-fill":T=new et;break;case"fill-when-pressed":default:T=new le;break}b&&await T.start(b)}}async function se(n){R("Device opened"),R(`Serial: ${await n.getSerialNumber()} Firmware: ${await n.getFirmwareVersion()}`),n.on("error",e=>{R(`Error: ${e}`)}),n.on("down",e=>{R(`${e.type}-${e.row}-${e.column} down`),T.controlDown(n,e).catch(console.error)}),n.on("up",e=>{R(`${e.type}-${e.row}-${e.column} up`),T.controlUp(n,e).catch(console.error)}),n.on("rotate",(e,t)=>{R(`${e.type}-${e.row}-${e.column} rotate ${t}`),T.controlRotate(n,e,t).catch(console.error)}),n.on("touchstart",e=>{R(`Touch start ${JSON.stringify(e)}`),T.touchStart(n,e).catch(console.error)}),n.on("touchmove",e=>{R(`Touch move ${JSON.stringify(e)}`),T.touchMove(n,e).catch(console.error)}),n.on("touchend",e=>{R(`Touch end ${JSON.stringify(e)}`),T.touchEnd(n,e).catch(console.error)}),await T.start(n),await n.setBrightness(70)}if(re){const n=async()=>{const r=await Qe();r.length>0&&(b=r[0],se(b).catch(console.error)),console.log(r)};window.addEventListener("load",()=>{n().catch(r=>console.error(r))});const e=document.getElementById("brightness-range");e&&e.addEventListener("input",r=>{const i=e.value;b&&b.setBrightness(i/100).catch(console.error)}),U&&(U.addEventListener("input",()=>{ie().catch(console.error)}),ie().catch(console.error));const t=async()=>{b&&(R("Closing device"),T.stop(b).catch(console.error),await b.close(),b=null);try{b=await je()}catch(r){R(`No device access granted: ${r}`);return}se(b).catch(console.error)};re.addEventListener("click",()=>{t().catch(r=>console.error(r))}),R("Page loaded")}
